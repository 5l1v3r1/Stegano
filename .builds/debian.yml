image: debian/sid
sources:
  - https://git.sr.ht/~cedric/Stegano
packages:
  - python3
  - python3-dev
  - python3-pip
tasks:
  - dependencies: |
      pip3 install --user poetry
      export PATH="$PATH:/home/build/.local/bin"
      cd Stegano
      poetry install
  - link: |
      export PATH="$PATH:/home/build/.local/bin"
      cd Stegano
      # stop the build if there are Python syntax errors or undefined names
      flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
      # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
      flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
  - test: |
      export PATH="$PATH:/home/build/.local/bin"
      cd Stegano
      poetry run nosetests --with-coverage --cover-package=stegano
  - typecheck: |
      export PATH="$PATH:/home/build/.local/bin"
      cd Stegano
      poetry run python tools/run_mypy.py
